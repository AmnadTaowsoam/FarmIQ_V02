# Mosquitto Configuration for FarmIQ Edge Layer
# 
# WARNING: This is a DEVELOPMENT-ONLY configuration.
# For production deployments, TLS and authentication MUST be enabled.

# Development Configuration (Current)
# ===================================
# Port 1883 (non-TLS MQTT) - DEV ONLY
listener 1883
persistence true
persistence_location /mosquitto/data/
log_dest stdout

# Dev-friendly settings (INSECURE - NOT FOR PRODUCTION)
allow_anonymous true

# Production Configuration (Required for Production)
# ==================================================
# TLS must be enabled for production. Uncomment and configure the following:
#
# # Port 8883 (TLS/SSL MQTT)
# listener 8883
# protocol mqtt
# cafile /mosquitto/config/ca.crt
# certfile /mosquitto/config/server.crt
# keyfile /mosquitto/config/server.key
# require_certificate false
# # Set require_certificate true for mTLS (mutual TLS) client authentication
#
# # Authentication and Authorization (Required for Production)
# # Option 1: Password file authentication
# password_file /mosquitto/config/passwordfile
# # Option 2: ACL file for topic-level authorization
# acl_file /mosquitto/config/aclfile
# # Option 3: mTLS client certificate authentication (use with require_certificate true)
#
# # Disable anonymous access for production
# allow_anonymous false
#
# Certificate Setup:
# - Obtain TLS certificates from your PKI or use cert-manager in Kubernetes
# - Store certificates in Kubernetes Secrets and mount to /mosquitto/config/
# - Ensure certificates are valid and not expired
# - Rotate certificates before expiration
#
# Password File Format (/mosquitto/config/passwordfile):
# - Use mosquitto_passwd utility to generate: mosquitto_passwd -c passwordfile username
# - Each line: username:hashed_password
#
# ACL File Format (/mosquitto/config/aclfile):
# - user username
# - topic readwrite farmiq/tenant/{tenant_id}/# (device-specific topics)
# - topic read farmiq/public/#
#
# Migration from Dev to Production:
# 1. Generate/obtain TLS certificates
# 2. Create password file and ACL file if using password auth
# 3. Update docker-compose.yml or Kubernetes deployment to mount certificates
# 4. Update IoT device configuration to use port 8883 with TLS
# 5. Test connectivity with TLS-enabled MQTT client
