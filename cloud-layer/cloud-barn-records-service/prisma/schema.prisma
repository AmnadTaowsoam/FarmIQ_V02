// This is your Prisma schema file for cloud-barn-records-service
generator client {
  provider = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model BarnMorbidityEvent {
  id                String    @id @default(uuid())
  tenantId          String    @map("tenant_id")
  farmId            String    @map("farm_id")
  barnId            String    @map("barn_id")
  batchId           String?   @map("batch_id")
  occurredAt        DateTime  @map("occurred_at")
  diseaseCode       String?   @map("disease_code")
  severity          String?   // low, medium, high
  animalCount       Int       @map("animal_count")
  notes             String?   @db.Text
  createdByUserId   String?   @map("created_by_user_id")
  createdAt         DateTime  @default(now()) @map("created_at")
  externalRef       String?   @map("external_ref")
  eventId           String?   @map("event_id")

  @@unique([tenantId, externalRef], name: "BarnMorbidityEvent_externalRef_key")
  @@unique([tenantId, eventId], name: "BarnMorbidityEvent_eventId_key")
  @@index([tenantId, occurredAt], map: "barn_morbidity_event_tenant_id_occurred_at_idx")
  @@index([tenantId, farmId, occurredAt])
  @@index([tenantId, barnId, occurredAt])
  @@index([tenantId, batchId, occurredAt])
  @@index([tenantId, occurredAt(sort: Desc)], map: "barn_morbidity_event_tenant_id_occurred_at_desc_idx")
  @@index([tenantId, diseaseCode])
  @@index([tenantId, createdByUserId])
  @@index([tenantId, createdAt(sort: Desc)])
  @@map("barn_morbidity_event")
}

model BarnMortalityEvent {
  id                String    @id @default(uuid())
  tenantId          String    @map("tenant_id")
  farmId            String    @map("farm_id")
  barnId            String    @map("barn_id")
  batchId           String?   @map("batch_id")
  occurredAt        DateTime  @map("occurred_at")
  causeCode         String?   @map("cause_code")
  animalCount       Int       @map("animal_count")
  disposalMethod    String?   @map("disposal_method") @db.Text
  notes             String?   @db.Text
  createdByUserId   String?   @map("created_by_user_id")
  createdAt         DateTime  @default(now()) @map("created_at")
  externalRef       String?   @map("external_ref")
  eventId           String?   @map("event_id")

  @@unique([tenantId, externalRef], name: "BarnMortalityEvent_externalRef_key")
  @@unique([tenantId, eventId], name: "BarnMortalityEvent_eventId_key")
  @@index([tenantId, occurredAt], map: "barn_mortality_event_tenant_id_occurred_at_idx")
  @@index([tenantId, farmId, occurredAt])
  @@index([tenantId, barnId, occurredAt])
  @@index([tenantId, batchId, occurredAt])
  @@index([tenantId, occurredAt(sort: Desc)], map: "barn_mortality_event_tenant_id_occurred_at_desc_idx")
  @@index([tenantId, causeCode])
  @@index([tenantId, createdByUserId])
  @@index([tenantId, createdAt(sort: Desc)])
  @@map("barn_mortality_event")
}

model BarnCullEvent {
  id                String    @id @default(uuid())
  tenantId          String    @map("tenant_id")
  farmId            String    @map("farm_id")
  barnId            String    @map("barn_id")
  batchId           String?   @map("batch_id")
  occurredAt        DateTime  @map("occurred_at")
  reasonCode        String?   @map("reason_code")
  animalCount       Int       @map("animal_count")
  notes             String?   @db.Text
  createdByUserId   String?   @map("created_by_user_id")
  createdAt         DateTime  @default(now()) @map("created_at")
  externalRef       String?   @map("external_ref")
  eventId           String?   @map("event_id")

  @@unique([tenantId, externalRef], name: "BarnCullEvent_externalRef_key")
  @@unique([tenantId, eventId], name: "BarnCullEvent_eventId_key")
  @@index([tenantId, occurredAt], map: "barn_cull_event_tenant_id_occurred_at_idx")
  @@index([tenantId, farmId, occurredAt])
  @@index([tenantId, barnId, occurredAt])
  @@index([tenantId, batchId, occurredAt])
  @@index([tenantId, occurredAt(sort: Desc)], map: "barn_cull_event_tenant_id_occurred_at_desc_idx")
  @@index([tenantId, reasonCode])
  @@index([tenantId, createdByUserId])
  @@index([tenantId, createdAt(sort: Desc)])
  @@map("barn_cull_event")
}

model BarnVaccineEvent {
  id                String    @id @default(uuid())
  tenantId          String    @map("tenant_id")
  farmId            String    @map("farm_id")
  barnId            String    @map("barn_id")
  batchId           String?   @map("batch_id")
  occurredAt        DateTime  @map("occurred_at")
  vaccineName       String    @map("vaccine_name")
  doseMl            Decimal?  @db.Decimal(8, 2) @map("dose_ml")
  route             String?   @db.Text // IM, SC, oral
  administeredBy    String?   @map("administered_by") @db.Text
  animalCount       Int       @map("animal_count")
  notes             String?   @db.Text
  createdAt         DateTime  @default(now()) @map("created_at")
  externalRef       String?   @map("external_ref")
  eventId           String?   @map("event_id")

  @@unique([tenantId, externalRef], name: "BarnVaccineEvent_externalRef_key")
  @@unique([tenantId, eventId], name: "BarnVaccineEvent_eventId_key")
  @@index([tenantId, occurredAt], map: "barn_vaccine_event_tenant_id_occurred_at_idx")
  @@index([tenantId, farmId, occurredAt])
  @@index([tenantId, barnId, occurredAt])
  @@index([tenantId, batchId, occurredAt])
  @@index([tenantId, occurredAt(sort: Desc)], map: "barn_vaccine_event_tenant_id_occurred_at_desc_idx")
  @@index([tenantId, vaccineName])
  @@index([tenantId, createdAt(sort: Desc)])
  @@map("barn_vaccine_event")
}

model BarnTreatmentEvent {
  id                String    @id @default(uuid())
  tenantId          String    @map("tenant_id")
  farmId            String    @map("farm_id")
  barnId            String    @map("barn_id")
  batchId           String?   @map("batch_id")
  occurredAt        DateTime  @map("occurred_at")
  treatmentName     String    @map("treatment_name")
  doseMl            Decimal?  @db.Decimal(8, 2) @map("dose_ml")
  route             String?   @db.Text
  durationDays      Int?      @map("duration_days")
  animalCount       Int       @map("animal_count")
  withdrawalDays    Int?      @map("withdrawal_days")
  notes             String?   @db.Text
  createdAt         DateTime  @default(now()) @map("created_at")
  externalRef       String?   @map("external_ref")
  eventId           String?   @map("event_id")

  @@unique([tenantId, externalRef], name: "BarnTreatmentEvent_externalRef_key")
  @@unique([tenantId, eventId], name: "BarnTreatmentEvent_eventId_key")
  @@index([tenantId, occurredAt], map: "barn_treatment_event_tenant_id_occurred_at_idx")
  @@index([tenantId, farmId, occurredAt])
  @@index([tenantId, barnId, occurredAt])
  @@index([tenantId, batchId, occurredAt])
  @@index([tenantId, occurredAt(sort: Desc)], map: "barn_treatment_event_tenant_id_occurred_at_desc_idx")
  @@index([tenantId, treatmentName])
  @@index([tenantId, createdAt(sort: Desc)])
  @@map("barn_treatment_event")
}

model BarnDailyCount {
  id                String    @id @default(uuid())
  tenantId          String    @map("tenant_id")
  farmId            String    @map("farm_id")
  barnId            String    @map("barn_id")
  batchId           String?   @map("batch_id")
  recordDate        DateTime  @db.Date @map("record_date")
  animalCount       Int       @map("animal_count")
  averageWeightKg   Decimal?  @db.Decimal(10, 3) @map("average_weight_kg")
  mortalityCount    Int       @default(0) @map("mortality_count")
  cullCount         Int       @default(0) @map("cull_count")
  createdAt         DateTime  @default(now()) @map("created_at")
  externalRef       String?   @map("external_ref")

  @@unique([tenantId, barnId, recordDate], name: "BarnDailyCount_barn_date_key")
  @@unique([tenantId, externalRef], name: "BarnDailyCount_externalRef_key")
  @@index([tenantId, recordDate])
  @@index([tenantId, farmId, recordDate])
  @@index([tenantId, barnId, recordDate])
  @@index([tenantId, batchId, recordDate])
  @@index([tenantId, createdAt(sort: Desc)])
  @@map("barn_daily_count")
}

model BarnWelfareCheck {
  id                String    @id @default(uuid())
  tenantId          String    @map("tenant_id")
  farmId            String    @map("farm_id")
  barnId            String    @map("barn_id")
  batchId           String?   @map("batch_id")
  occurredAt        DateTime  @map("occurred_at")
  gaitScore         Int?      @map("gait_score") // 0-5
  lesionScore       Int?      @map("lesion_score") // 0-5
  behaviorScore     Int?      @map("behavior_score") // 0-5
  observer          String?   @db.Text
  notes             String?   @db.Text
  createdAt         DateTime  @default(now()) @map("created_at")
  externalRef       String?   @map("external_ref")

  @@unique([tenantId, externalRef], name: "BarnWelfareCheck_externalRef_key")
  @@index([tenantId, occurredAt], map: "barn_welfare_check_tenant_id_occurred_at_idx")
  @@index([tenantId, farmId, occurredAt])
  @@index([tenantId, barnId, occurredAt])
  @@index([tenantId, batchId, occurredAt])
  @@index([tenantId, occurredAt(sort: Desc)], map: "barn_welfare_check_tenant_id_occurred_at_desc_idx")
  @@index([tenantId, createdAt(sort: Desc)])
  @@map("barn_welfare_check")
}

model BarnHousingCondition {
  id                String    @id @default(uuid())
  tenantId          String    @map("tenant_id")
  farmId            String    @map("farm_id")
  barnId            String    @map("barn_id")
  occurredAt        DateTime  @map("occurred_at")
  stockingDensity   Decimal?  @db.Decimal(8, 2) @map("stocking_density")
  beddingType       String?   @map("bedding_type") @db.Text
  ventilationMode   String?   @map("ventilation_mode") @db.Text
  temperatureC      Decimal?  @db.Decimal(5, 2) @map("temperature_c")
  humidityPct       Decimal?  @db.Decimal(5, 2) @map("humidity_pct")
  ammoniaPpm        Decimal?  @db.Decimal(8, 2) @map("ammonia_ppm")
  notes             String?   @db.Text
  createdAt         DateTime  @default(now()) @map("created_at")
  externalRef       String?   @map("external_ref")

  @@unique([tenantId, externalRef], name: "BarnHousingCondition_externalRef_key")
  @@index([tenantId, occurredAt], map: "barn_housing_condition_tenant_id_occurred_at_idx")
  @@index([tenantId, farmId, occurredAt])
  @@index([tenantId, barnId, occurredAt])
  @@index([tenantId, occurredAt(sort: Desc)], map: "barn_housing_condition_tenant_id_occurred_at_desc_idx")
  @@index([tenantId, createdAt(sort: Desc)])
  @@map("barn_housing_condition")
}

model BarnGeneticProfile {
  id                String    @id @default(uuid())
  tenantId          String    @map("tenant_id")
  batchId           String    @map("batch_id")
  strain            String?   @db.Text
  breedLine         String?   @map("breed_line") @db.Text
  supplier          String?   @db.Text
  hatchDate         DateTime? @db.Date @map("hatch_date")
  createdAt         DateTime  @default(now()) @map("created_at")
  externalRef       String?   @map("external_ref")

  @@unique([tenantId, batchId], name: "BarnGeneticProfile_batch_key")
  @@unique([tenantId, externalRef], name: "BarnGeneticProfile_externalRef_key")
  @@index([tenantId, batchId])
  @@index([tenantId, createdAt(sort: Desc)])
  @@map("barn_genetic_profile")
}

