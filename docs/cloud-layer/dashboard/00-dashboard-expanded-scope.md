# Dashboard Expanded Scope

**Purpose**: Define the comprehensive scope, goals, and commercial-scale requirements for the FarmIQ Dashboard.  
**Scope**: Dashboard goals, multi-tenant architecture, BFF integration pattern, and commercial-scale assumptions.  
**Owner**: FarmIQ Frontend Team  
**Last updated**: 2025-01-20  

---

## Dashboard Goals

The FarmIQ Dashboard (`dashboard-web`) serves as the primary user interface for:

### 1. Operations Monitoring
- **Real-time telemetry visualization**: Temperature, humidity, weight, and other sensor metrics across farms and barns.
- **Device health monitoring**: Device status, connectivity, last-seen timestamps, and anomaly detection.
- **Data quality visibility**: Data freshness, coverage gaps, and sync status from edge to cloud.

### 2. WeighVision Intelligence
- **Session management**: View and analyze WeighVision sessions (weight measurements, image captures, inference results).
- **Weight analytics**: Trends, distributions, uniformity metrics, and size proxies.
- **Model performance**: Inference confidence, drift detection, and model version tracking.

### 3. Feeding & FCR (Feed Conversion Ratio)
- **Daily feed intake tracking**: Monitor feed consumption per barn/batch.
- **FCR computation**: Calculate and visualize Feed Conversion Ratio over time.
- **Forecasting**: Predict market weight ETA and FCR trends based on historical data.

### 4. AI Insights
- **Anomaly detection**: Early warning system for environmental anomalies, weight deviations, and health indicators.
- **Recommendations**: AI-driven actionable recommendations (e.g., adjust temperature, check feed levels).
- **Scenario planning**: "What-if" analysis for feed adjustments, environmental changes, and operational decisions.

---

## Commercial Scale Assumptions

### Multi-Tenant Architecture
- **Tenant isolation**: Strict data isolation between tenants. No cross-tenant data leakage.
- **Hierarchical context**: Tenant → Farm → Barn → Batch/Species → Device hierarchy.
- **Scalability**: Support for:
  - **100+ tenants** per deployment
  - **1,000+ farms** per tenant (large enterprise customers)
  - **10,000+ barns** across all tenants
  - **100,000+ devices** total
  - **1M+ telemetry readings per day** per tenant

### RBAC (Role-Based Access Control)
- **Role hierarchy**: Platform Admin → Tenant Admin → Farm Manager → Operator → Viewer
- **Permission granularity**: Page-level, feature-level, and data-level permissions.
- **Audit requirements**: All admin actions must be logged for compliance.

### Performance Requirements
- **Initial page load**: < 2 seconds (P95)
- **Chart rendering**: < 500ms for time-series data (last 7 days)
- **Data freshness**: Telemetry data visible within 60 seconds of ingestion (edge → cloud sync)
- **Concurrent users**: Support 500+ concurrent users per tenant

---

## FE-to-BFF Integration Pattern

### Core Principle
**`dashboard-web` MUST call ONLY `cloud-api-gateway-bff` for all data requirements.**

### Rationale
1. **Abstraction**: BFF abstracts microservice complexity (telemetry-service, analytics-service, tenant-registry, etc.).
2. **Aggregation**: BFF can aggregate data from multiple services in a single request (e.g., Farm details + alerts + summary KPIs).
3. **Tenant context enforcement**: BFF validates tenant context on every request, preventing cross-tenant data access.
4. **Optimization**: BFF can optimize payloads for frontend consumption (e.g., flattening nested structures, selecting only required fields).

### Exception
- **Auth endpoints**: `/api/v1/auth/login` and `/api/v1/auth/refresh` may be called directly if the Gateway proxies them transparently. However, prefer routing through BFF for consistency.

### Data Flow
```
dashboard-web (React)
    ↓ HTTP (Bearer token + x-request-id)
cloud-api-gateway-bff
    ↓ Internal calls (service-to-service)
cloud-telemetry-service
cloud-analytics-service
cloud-tenant-registry
cloud-identity-access
```

### Request Headers (Required)
All requests to BFF MUST include:
- `Authorization: Bearer <access_token>`
- `x-request-id: <uuid-v4>` (generated by FE for tracing)
- `Content-Type: application/json` (for POST/PATCH requests)

### Context Propagation
- **Tenant context**: Sent via query parameter `tenant_id` (validated by BFF against JWT claims).
- **Farm/Barn context**: Sent via query parameters `farm_id`, `barn_id` (validated against tenant access).
- **Time range**: Sent via query parameters `start_time`, `end_time` (ISO 8601 format).

---

## Related Documentation

- [Information Architecture](01-information-architecture.md): Navigation, context selector, and page grouping.
- [Page Specifications](02-page-specs.md): Detailed specifications for all dashboard pages.
- [BFF API Contracts](04-bff-api-contracts.md): Complete API endpoint definitions.
- [Multi-Tenant & RBAC](06-multi-tenant-and-rbac.md): Role definitions and permission matrix.

---

## Implementation Phases

### Phase 1: MVP (Current)
- Basic telemetry visualization
- WeighVision session list and detail
- Farm/Barn/Device registry views
- Basic alerts (view-only)

### Phase 2: Analytics & Intelligence
- Weight analytics and distributions
- FCR computation and forecasting
- Sensor correlation analysis
- Anomaly detection and early warnings

### Phase 3: AI & Optimization
- AI recommendations
- Scenario planner (what-if analysis)
- Model drift monitoring
- Advanced reporting and export

### Phase 4: Enterprise Features
- Custom dashboards
- Advanced RBAC (field-level permissions)
- Data export (parquet/CSV)
- Integration APIs for external systems

---

## Success Metrics

- **User adoption**: 80%+ of active tenants use dashboard weekly
- **Performance**: 95% of page loads < 2 seconds
- **Data freshness**: 99% of telemetry visible within 60 seconds
- **Error rate**: < 0.1% of API requests result in 5xx errors
- **User satisfaction**: NPS score > 50 (when measured)

